import{c as m,o as y,a as p,i as h,b as f,X as x,d as C,f as $,P as M,u as k,e as v,t as g,C as w,g as a,j as _,h as S}from"./index-h-SgYMPC.js";const R=g('<div class="relative w-full h-full"><div class="absolute top-0 right-0"><button class="text-gray-300 h-6 w-6 p-1"title=画像として保存></button></div><canvas class="w-full h-full">'),Z=g('<button class="text-gray-300 h-6 w-6 p-1"title=ズームリセット>'),P=t=>{let l,o;const[c,d]=m(!1);y(()=>{console.log("RegressionChart",{canvas:l}),o=new w(l,{type:"line",data:{datasets:[{label:`${t.name}(${t.symbol})`,backgroundColor:a("bg-cyan-300"),borderColor:a("bg-cyan-300"),borderWidth:1,pointRadius:0,data:t.data.map(e=>({x:e.date,y:e.close}))},{label:"回帰直線",backgroundColor:a("bg-green-400"),borderColor:a("bg-green-400"),borderWidth:1,pointRadius:0,data:t.data.map(e=>({x:e.date,y:e.regression}))},{label:"回帰直線との差",backgroundColor:a("bg-gray-300"),borderColor:a("bg-gray-300"),borderWidth:1,pointRadius:0,fill:{value:0,above:a("bg-red-600"),below:a("bg-blue-600")},data:t.data.map(e=>({x:e.date,y:Math.log10(e.close)-Math.log10(e.regression)})),yAxisID:"y2"}]},options:{animation:!1,maintainAspectRatio:!1,responsive:!0,scales:{x:{type:"time",adapters:{date:{locale:_}},time:{unit:"year",tooltipFormat:"yyyy/MM/dd"},bounds:"ticks"},y:{title:{display:!0,text:"価格 [USドル] (ログスケール)"},type:"logarithmic",display:"auto",grid:{display:!1}},y2:{title:{display:!0,text:"回帰直線との差 [log10]"},type:"linear",axis:"y",position:"right",display:"auto",max:.7,min:-.7,ticks:{stepSize:.1}}},interaction:{intersect:!1,mode:"index",includeInvisible:!0},plugins:{zoom:{zoom:{wheel:{enabled:!0},pinch:{enabled:!0},drag:{enabled:!0,modifierKey:"shift"},mode:"x",onZoom:e=>d(e.chart.isZoomedOrPanned())},pan:{enabled:!0,mode:"x"},limits:{x:{min:"original",max:"original"}}}}},plugins:[S(a("bg-gray-900"))]})}),p(()=>{o?.destroy()});const u=()=>{o?.resetZoom(),d(!1)};return(()=>{const e=R(),s=e.firstChild,i=s.firstChild,b=s.nextSibling;return h(s,(()=>{const r=f(()=>!!c());return()=>r()&&(()=>{const n=Z();return n.$$click=u,n.innerHTML=x,n})()})(),i),i.$$click=()=>C(o?.toBase64Image(),`SP500_${$(new Date,"yyyyMMdd-HHmmss")}.png`),i.innerHTML=M,k(r=>l=r,b),e})()};v(["click"]);export{P as RegressionChart};
